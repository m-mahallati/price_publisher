stages:
  - build
  - push

variables:
  VERSION: "1.0.0"
  REGISTRY: "registry.ahurix.com"
  PROJECT: "tools"
  IMAGE_NAME: "${REGISTRY}/${PROJECT}/price_publisher"

# Use Docker-in-Docker (dind) service
default:
  image: docker:27.0.3
  services:
    - docker:27.0.3-dind
  before_script:
    - apk add --no-cache make bash
    # login to private registry (set CI_REGISTRY_USER + CI_REGISTRY_PASSWORD in GitLab settings)
    - echo "$CI_REGISTRY_PASSWORD" | docker login -u "$CI_REGISTRY_USER" --password-stdin $REGISTRY

build-job:
  stage: build
  script:
    - make build

push-job:
  stage: push
  script:
    - make push
  only:
    - main   # only push to registry on commits to main branch (adjust as needed)
